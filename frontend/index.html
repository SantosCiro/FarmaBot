<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FarmaBot - Simulador</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f2f2f2; margin:0; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 16px; }
    .card { background:#fff; border-radius: 12px; padding: 12px; box-shadow: 0 2px 10px rgba(0,0,0,.08); }
    .top { display:flex; gap:12px; margin-bottom: 10px; }
    input { padding:10px; border:1px solid #ddd; border-radius:10px; width:100%; }
    .chat { height: 520px; overflow:auto; padding: 12px; background:#e9f0e9; border-radius: 12px; }
    .msg { max-width: 80%; padding: 10px 12px; border-radius: 12px; margin: 8px 0; white-space: pre-wrap; }
    .me { background:#d1ecff; margin-left:auto; }
    .bot { background:#fff; border: 1px solid #e6e6e6; }
    .row { display:flex; gap:10px; margin-top: 10px; }
    button { padding: 10px 14px; border:0; border-radius: 10px; cursor:pointer; }
    button:hover { opacity:.9; }
    .send { width: 120px; }
    .hint { color:#666; font-size: 12px; margin-top: 8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <input id="name" placeholder="Seu nome (opcional)" />
        <input id="phone" placeholder="Telefone (opcional)" />
      </div>

      <div id="chat" class="chat"></div>

      <div class="row">
        <input id="text" placeholder="Digite sua mensagem..." />
        <button class="send" id="send">Enviar</button>
      </div>
      <div class="hint">Dica: teste ‚Äúhor√°rio‚Äù, ‚Äúentrega‚Äù, ‚Äúendere√ßo‚Äù, ‚Äútem dipirona?‚Äù, ‚Äúfalar com atendente‚Äù.</div>
    </div>
  </div>

  <script>
    const API = "http://127.0.0.1:8000";
    const chat = document.getElementById("chat");
    const text = document.getElementById("text");
    const name = document.getElementById("name");
    const phone = document.getElementById("phone");
    const sendBtn = document.getElementById("send");

    function addMsg(who, content) {
      const div = document.createElement("div");
      div.className = `msg ${who}`;
      div.textContent = content;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    async function send() {
      const msg = text.value.trim();
      if (!msg) return;
      addMsg("me", msg);
      text.value = "";

      const payload = { message: msg, name: name.value.trim() || null, phone: phone.value.trim() || null };

      try {
        const res = await fetch(`${API}/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        addMsg("bot", data.reply);
      } catch (e) {
        addMsg("bot", "Erro ao conectar no servidor. Voc√™ ligou o backend?");
      }
    }

    addMsg("bot", "Ol√°! üëã Sou o assistente virtual da farm√°cia. Posso ajudar com hor√°rio, entrega/retirada, disponibilidade de medicamentos e endere√ßo/contato.");

    sendBtn.addEventListener("click", send);
    text.addEventListener("keydown", (e) => {
      if (e.key === "Enter") send();
    });
  </script>
</body>
</html>
